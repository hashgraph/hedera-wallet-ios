# .circleci/config.yml
version: 2
jobs:
  ios-environment-setup:
    macos:
      xcode: "11.3.1"
    environment:
      FL_OUTPUT_DIR: output
    steps:
      # Repository cache
      - restore-cache:
          keys:
            - source-v1-{{ .Branch }}-{{ .Revision }}
            - source-v1-{{ .Branch }}-
            - source-v1-
      - checkout
      - save-cache:
          key: source-v1-{{ .Branch }}-{{ .Revision }}
          paths:
            - .git
      - run:
          name: Print Homebrew Information
          command: .circleci/scripts/print_homebrew_info.sh
      - run:
          name: Brew User Ruby
          command: .circleci/scripts/brew_user_ruby.sh
      - run:
          name: Print Ruby and Gem Information
          command: .circleci/scripts/print_ruby_gem_info.sh
      - run:
          name: Install Cocoapods
          command: gem install cocoapods --user-install
      - run:
          name: Install Dependencies
          command: .circleci/scripts/install_dependencies.sh
      - run:
          name: Build for testing
          command: xcodebuild build-for-testing
            -workspace HGCApp.xcworkspace
            -scheme Debug
            -configuration Debug
            -destination 'platform=iOS Simulator,name=iPhone 8'
      - run:
          name: Run unit tests
          command: xcodebuild test-without-building
            -workspace HGCApp.xcworkspace
            -scheme Debug
            -configuration Debug
            -destination 'platform=iOS Simulator,name=iPhone 8'
      - run:
          name: Build for running
          command: xcodebuild build
            -workspace HGCApp.xcworkspace
            -scheme Debug
            -configuration Debug
            -destination 'platform=iOS Simulator,name=iPhone 8'

workflows:
  version: 2
  build-and-unit-test:
    jobs:
      - ios-environment-setup
